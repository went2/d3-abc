<!DOCTYPE html>
<html>
  <head>
    <title>Data-binding</title>
  </head>
  <body>
    <div id="wrapper"></div>
    <script src="../lib/d3.min.js"></script>
    <script>
      const dimensions = {
        width: window.innerWidth * 0.8,
        height: 400,
        margin: {
          top: 10,
          right: 20,
          bottom: 50,
          left: 40,
        },
      };
      dimensions.boundedWidth =
        dimensions.width - dimensions.margin.left - dimensions.margin.right;
      dimensions.boundedHeight =
        dimensions.height - dimensions.margin.top - dimensions.margin.bottom;
      // 绘制 tweets 推文影响力散点图
      async function drawScatterplot() {
        const wrapper = d3.select("#wrapper");
        wrapper.html("从磁盘加载数据到内存...");
        const { tweets } = await d3.json("./tweets.json");
        wrapper.html("");

        // 处理数据
        const datasetMap = d3.group(tweets, (d) => d.user);
        const dataset = Array.from(datasetMap, ([key, value]) => ({
          key,
          value,
        }));
        dataset.forEach((item) => {
          item.tweetsCounts = item.value.length;
        });

        const bounds = wrapper
          .append("svg")
          .attr("width", dimensions.width)
          .attr("height", dimensions.height)
          .append("g")
          .attr("width", dimensions.boundedWidth)
          .attr("height", dimensions.boundedHeight)
          .style(
            "transform",
            `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
          );
      }
      drawScatterplot();
    </script>
  </body>
</html>
